<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AF1CESTREAM</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: sans-serif; }
        .header { background: #111; padding: 10px; border-bottom: 2px solid #ffc107; text-align: center; }
        .btn { display: inline-block; padding: 8px 12px; margin: 5px; background: #333; color: #fff; border-radius: 4px; cursor: pointer; font-size: 10px; }
        .btn.active { background: #ffc107; color: #000; }
        .grid { padding: 10px; display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 8px; }
        .item { background: #222; border-radius: 8px; padding: 10px; text-align: center; }
        .item a { color: #fff; text-decoration: none; font-size: 10px; }
        .item img { width: 40px; height: 40px; display: block; margin: 0 auto 5px; }
    </style>
</head>
<body>

<div class="header">
    <h2 style="color: #ffc107; margin: 5px 0;">AF1CESTREAM</h2>
    <button class="btn active" onclick="load('acex')">Canales Acex</button>
    <button class="btn" onclick="load('events')">Eventos Acex</button>
    <button class="btn" onclick="load('pre')">Canales Pre</button>
    <button class="btn" onclick="load('pre-events')">Eventos Pre</button>
    <button class="btn" onclick="load('vpn')">VPN</button>
</div>

<div id="grid" class="grid"></div>

<script>
    const LOGO = 'https://i.postimg.cc/hPgpp1t3/1768043171823-removebg-preview.png';

    // FUNCIONES DE PARSEADO SENCILLO
    function parseM3U(text) {
        const ch = [];
        const lines = text.split('\n');
        for (let i = 0; i < lines.length; i++) {
            if (lines[i].startsWith('#EXTINF:')) {
                const name = lines[i].split(',')[1]?.trim();
                const link = lines[i + 1]?.trim();
                if (name && link && link.startsWith('http')) ch.push({name, link});
            }
        }
        return ch;
    }

    function parseXML(text) {
        const ch = [];
        const parser = new DOMParser();
        const xml = parser.parseFromString(text, 'text/xml');
        xml.querySelectorAll('channel, canal, evento, track').forEach(el => {
            const name = el.getAttribute('name') || el.querySelector('nombre, title')?.textContent || 'Canal';
            const url = el.querySelector('url')?.textContent;
            if (url && url.startsWith('http')) ch.push({name, link: url});
        });
        return ch;
    }

    // CARGA CON TIMEOUT Y ERROR VISIBLE
    async function load(type) {
        document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        
        const grid = document.getElementById('grid');
        grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: #ffc107;">CARGANDO...</div>';
        
        const urls = {
            acex: 'https://raw.githubusercontent.com/Icastresana/lista1/refs/heads/main/Probando',
            events: 'https://raw.githubusercontent.com/Icastresana/lista1/main/eventos.m3u',
            pre: 'https://raw.githubusercontent.com/tutw/platinsport-m3u-updater/refs/heads/main/lista_canales_DEPORTE-LIBRE.FANS.xml',
            'pre-events': 'https://raw.githubusercontent.com/tutw/platinsport-m3u-updater/refs/heads/main/eventos_livetv_sx_con_reproductores.xml',
            vpn: 'https://raw.githubusercontent.com/tutw/platinsport-m3u-updater/refs/heads/main/lista_sportsonlineci.xml'
        };
        
        const controller = new AbortController();
        setTimeout(() => controller.abort(), 8000); // 8s timeout
        
        try {
            const res = await fetch(urls[type], {signal: controller.signal});
            if (!res.ok) throw new Error('Error de red');
            const text = await res.text();
            const channels = urls[type].endsWith('.m3u') ? parseM3U(text) : parseXML(text);
            
            if (channels.length === 0) throw new Error('Lista vacía');
            
            grid.innerHTML = channels.map(ch => `
                <div class="item">
                    <a href="${ch.link.trim()}" target="_blank" rel="noreferrer">
                        <img src="${LOGO}">${ch.name}
                    </a>
                </div>
            `).join('');
            
        } catch(e) {
            grid.innerHTML = `<div style="grid-column: 1/-1; color: red; text-align: center;">
                <b>❌ ERROR:</b> ${e.message}<br><br>
                Verifica la URL o prueba otra lista
            </div>`;
        }
    }

    // Cargar inicial
    load('acex').then(() => console.log('Cargado'));
</script>
</body>
</html>
